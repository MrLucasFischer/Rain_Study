---
title: "rain_study"
author: "L.Fischer"
date: "7/30/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Rain Study

## Introduction

This is an R Markdown script containing my study on the Australian Rain dataset, which can be found [here](https://www.kaggle.com/jsphyg/weather-dataset-rattle-package).

I'll start off by loading the needed libraries and importing the dataset

```{r libs, message=FALSE, warning=FALSE}
library(tidyverse)
library(caret)
library(keras)

data = read_csv("../input/weatherAUS.csv")
dim(data)
```

Checking a small portion of the dataset

```{r}
head(data)
```

We can factorize some of the columns that make sense to do it
```{r}
data = data %>% 
    mutate_at(vars(Location, WindGustDir, WindDir9am, WindDir3pm, RainToday, RainTomorrow), as.factor)
```

We can see by the output of the `head` function that columns `Evaporation`, `Sunshine` and some others appear to have a lot of missing values. It's important to check how many missing values are in each column.
For that we just summarise each column as the sum of the number of missing values in them (I'm transposing the result tibble so that it's possible to see all variables at the same time)

```{r}
data %>%
    summarise_each(list(~ sum(is.na(.)) / length(.) * 100)) %>%
    t()
```

We clearly see that the most alarming columns are `Evaporation`, `Sunshine`, which have around 98% of missing values, I guess someone forgot to register these variables :). `Cloud9am` and `Cloud3pm` are possibly problamatic as well so we'll remove these columns too.

For the rest of the columns we have to make some decisions. We can try to replace the missing values with the means of each column (or with any other technique we see fit) but that might bias our study. Another possibility might be to delete the rows in each a column has a missing value. These remaining columns have a relative low percentage of missing values, but it might be that all missing values are from examples of one of the classes (for example the class of observations in each it rained the next day, the class of interest) and so removing might make us lose valuable information for that class. We'll go with this decision (because I'm lazy and this is simpler (: ). But first let's check to see the percentage of missing values for each column and for each class to make sure we're not removing valuable information.

To do this we can run the exact same computation as before, just grouping by our dependent variable `RainTomorrow` (Note that I'm already removing the columns discussed before)

```{r}
data = data %>% select(-Evaporation, -Sunshine, -Cloud9am, -Cloud3pm)

data %>%
    group_by(RainTomorrow) %>%
    summarise_each(list(~ sum(is.na(.)) / length(.) * 100)) %>%
    t()
```

Great, nothing that alarming! We can simply remove rows with missing values and we're all set!

```{r}
data = data %>% na.exclude()
dim(data)
```

## Visualizations

The goal of making visualizations is to try and get a more familiar sense of the data we're dealing with. We might try to answer some questions that might help us when building our machine learning/deep learning model

Some questions of interest:

* When it rains one day, does it normally rain the next day?
* What is the correlation between the amount of Rainfall and the max (or min) temperature?
* What is the correlation between the humidity in the morning (or at 3pm) and the amount of rainfall?

To answer this questions we'll make a plot for each of them

```{r}
data %>%
    ggplot(aes(x = RainToday, fill = RainTomorrow, color = RainTomorrow)) +
    geom_bar(aes(y = ((..count..) / sum(..count..))), position = "identity", alpha = 0.5) +
    scale_y_continuous(breaks = seq(0, 1, by = 0.05),
                       labels = scales::percent) +
    labs(x = "Rained Today",
         y = "Percentage",
         title = "Bar plot of the distribution of the RainToday variable, colorized depending if it rained the next day",
         color = "Rained the next day",
         fill = "Rained the next day"
         )
```

This is really important, it seems that when it rains one day it will usually rain the next day, so it might be important to keep this variable